<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML+RDFa 1.0//EN"
  "http://www.w3.org/MarkUp/DTD/xhtml-rdfa-1.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" version="XHTML+RDFa 1.0" dir="ltr"
  xmlns:content="http://purl.org/rss/1.0/modules/content/"
  xmlns:dc="http://purl.org/dc/terms/"
  xmlns:foaf="http://xmlns.com/foaf/0.1/"
  xmlns:og="http://ogp.me/ns#"
  xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
  xmlns:sioc="http://rdfs.org/sioc/ns#"
  xmlns:sioct="http://rdfs.org/sioc/types#"
  xmlns:skos="http://www.w3.org/2004/02/skos/core#"
  xmlns:xsd="http://www.w3.org/2001/XMLSchema#">

<head profile="http://www.w3.org/1999/xhtml/vocab">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="BEAST_favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="shortlink" href="31.html" />
<link rel="canonical" href="tutorial-8.html" />
<meta name="Generator" content="Drupal 7 (http://drupal.org)" />
  <title>Tutorial 8 | BEAST</title>
  <style type="text/css" media="all">
@import url("system.base.css%3Fou07bk.css");
@import url("system.menus.css%3Fou07bk.css");
@import url("system.messages.css%3Fou07bk.css");
@import url("system.theme.css%3Fou07bk.css");
</style>
<style type="text/css" media="all">
@import url("field.css%3Fou07bk.css");
@import url("node.css%3Fou07bk.css");
@import url("search.css%3Fou07bk.css");
@import url("user.css%3Fou07bk.css");
@import url("ckeditor.css%3Fou07bk.css");
</style>
<style type="text/css" media="all">
@import url("style.css%3Fou07bk.css");
</style>
<style type="text/css" media="print">
@import url("print.css%3Fou07bk.css");
</style>

<!--[if lt IE 7]>
<link type="text/css" rel="stylesheet" href="http://sbsweb2-bak.bio.ed.ac.uk/beast/themes/garland/fix-ie.css?ou07bk" media="all" />
<![endif]-->
  <script type="text/javascript" src="jquery.js%3Fv=1.4.4"></script>
<script type="text/javascript" src="jquery.once.js%3Fv=1.2"></script>
<script type="text/javascript" src="drupal.js%3Fou07bk"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, {"basePath":"\/beast\/","pathPrefix":"","ajaxPageState":{"theme":"garland","theme_token":"HmRKrkQin605ruqw-XpAllLYKJCHxygay8yzcubUWWg","js":{"misc\/jquery.js":1,"misc\/jquery.once.js":1,"misc\/drupal.js":1},"css":{"modules\/system\/system.base.css":1,"modules\/system\/system.menus.css":1,"modules\/system\/system.messages.css":1,"modules\/system\/system.theme.css":1,"modules\/field\/theme\/field.css":1,"modules\/node\/node.css":1,"modules\/search\/search.css":1,"modules\/user\/user.css":1,"sites\/all\/modules\/ckeditor\/css\/ckeditor.css":1,"themes\/garland\/style.css":1,"themes\/garland\/print.css":1,"themes\/garland\/fix-ie.css":1}}});
//--><!]]>
</script>
</head>
<body class="html not-front not-logged-in no-sidebars page-node page-node- page-node-31 node-type-article fluid-width" >
  <div id="skip-link">
    <a href="Tutorial-8.html#main-content" class="element-invisible element-focusable">Skip to main content</a>
  </div>
      
  <div id="wrapper">
    <div id="container" class="clearfix">

      <div id="header">
        <div id="logo-floater">
                              <div id="branding"><strong><a href="index.html">
                          <img src="beast.png" alt="BEAST " title="BEAST " id="logo" />
                        <span>BEAST</span>            </a></strong></div>
                          </div>

        <h2 class="element-invisible">Main menu</h2><ul class="links inline main-menu"><li class="menu-230 first"><a href="index.html">Home</a></li>
<li class="menu-307"><a href="programs.html">Programs</a></li>
<li class="menu-329"><a href="downloads.html">Downloads</a></li>
<li class="menu-312"><a href="tutorials.html" title="Tutorials and documentation on using BEAST">Tutorials</a></li>
<li class="menu-326"><a href="error-messages.html">Error Messages</a></li>
<li class="menu-313 last"><a href="faq.html" title="Frequently Asked Questions">FAQ</a></li>
</ul>              </div> <!-- /#header -->

      
      <div id="center"><div id="squeeze"><div class="right-corner"><div class="left-corner">
          <h2 class="element-invisible">You are here</h2><div class="breadcrumb"><a href="index.html">Home</a></div>                    <a id="main-content"></a>
          <div id="tabs-wrapper" class="clearfix">                                <h1 class="with-tabs">Tutorial 8</h1>
                              </div>                                                  <div class="clearfix">
            <div id="node-31" class="node node-article node-promoted" about="/beast/tutorial-8" typeof="sioc:Item foaf:Document">

  
      <span property="dc:title" content="Tutorial 8" class="rdf-meta element-hidden"></span>
      <span class="submitted"><span property="dc:date dc:created" content="2014-08-18T12:09:14+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Mon, 08/18/2014 - 12:09 — <span class="username" xml:lang="" about="/beast/users/rambaut" typeof="sioc:UserAccount" property="foaf:name" datatype="">rambaut</span></span></span>
  
  <div class="content clearfix">
    <div class="field field-name-body field-type-text-with-summary field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p><a href="Home.html" style="text-decoration: none; color: rgb(90, 54, 150); background-image: none; background-position: initial initial; background-repeat: initial initial;" title="Main Page">BEAST Documentation</a>-&gt;<a href="Tutorials.html" style="text-decoration: none; color: rgb(90, 54, 150); background-image: none; background-position: initial initial; background-repeat: initial initial;" title="Tutorials">Tutorials</a>-&gt;Tutorial 8</p>
<hr /><h2>Analyzing multi-locus data</h2>
<p>This tutorial describes how to create a <a href="http://sbsweb2-bak.bio.ed.ac.uk/beast/Introduction-to-XML-format" style="text-decoration: none; color: rgb(90, 54, 150); background-image: none; background-position: initial initial; background-repeat: initial initial;" title="Introduction to XML format">BEAST XML</a> file for analyzing multiple loci alignments sampled from the same population. Although the different loci have different genealogies, they are assumed to share the same demographic history. Having multiple unlinked loci can give a large improvement in the power to reconstruct the demographic history.</p>
<p>This tutorial is a rather involved exercise in editing XML with lots of copy and paste. Basically, certain elements must be duplicated so that each locus alignment has its own copy which can operate independently. Other elements (particularly the demographic model) are shared between the multiple alignments. This tutorial describes setting up a two locus model but it should be obvious how to extend it to more.</p>
<p>The easiest way to start to create this analysis is to use <a href="https://web.archive.org/web/20120507151410/http://beast.bio.ed.ac.uk/BEAUti" style="text-decoration: none; color: rgb(90, 54, 150); background-image: none; background-position: initial initial; background-repeat: initial initial;" title="BEAUti">BEAUti</a> to create an XML BEAST file for each individual locus' alignment. <a href="https://web.archive.org/web/20120507151410/http://beast.bio.ed.ac.uk/Tutorial_2" style="text-decoration: none; color: rgb(90, 54, 150); background-image: none; background-position: initial initial; background-repeat: initial initial;" title="Tutorial 2">See this tutorial for instructions on how to do this</a>. Now start editing the XML file for the first locus' alignment and start adding text. Look for the alignment element:</p>
<pre>
	&lt;alignment id="alignment" dataType="nucleotide"&gt;
		&lt;sequence&gt;
			&lt;taxon idref="individual1"/&gt;
			AGAAATATGTCTGATA...
		&lt;/sequence&gt;
		&lt;sequence&gt;
			&lt;taxon idref="individual2"/&gt;
			AGAAATATGTCTGATA...
		&lt;/sequence&gt;
		&lt;sequence&gt;
			&lt;taxon idref="individual3"/&gt;
			AGAAATATGTCTGATA...
		&lt;/sequence&gt;
		&lt;sequence&gt;
			&lt;taxon idref="individual4"/&gt;
			AGAAATATGTCTGATA...
		&lt;/sequence&gt;
		&lt;sequence&gt;
			&lt;taxon idref="individual5"/&gt;
			AGAAATATGTCTGACA...
		&lt;/sequence&gt;
		&lt;sequence&gt;
			&lt;taxon idref="individual6"/&gt;
			AGAAATACGTCTGACG...
		&lt;/sequence&gt;
	&lt;/alignment&gt;
</pre><p>Note actual sequences have been truncated for displaying here. The first thing to change is the id of the alignment element to "alignment1":</p>
<pre>
	&lt;alignment id="alignment1" dataType="nucleotide"&gt;
</pre><p>Now paste the alignment element from the XML document for the second locus into the first file just after the first alignment element, changing the id to "alignment2":</p>
<pre>
	&lt;alignment id="alignment1" dataType="nucleotide"&gt;
	.
	.
	.
	&lt;/alignment&gt;

	&lt;alignment id="alignment2" dataType="nucleotide"&gt;
		&lt;sequence&gt;
			&lt;taxon idref="individual1"/&gt;
			GCCCTCAGTAAGTTG...
		&lt;/sequence&gt;
		&lt;sequence&gt;
			&lt;taxon idref="individual2"/&gt;
			GCCCTCAGCAAGTTA...
		&lt;/sequence&gt;
		&lt;sequence&gt;
			&lt;taxon idref="individual3"/&gt;
			GCTCTCAGTAAGTTA...
		&lt;/sequence&gt;
		&lt;sequence&gt;
			&lt;taxon idref="individual4"/&gt;
			GCCCTTAGTAAGTTA...
		&lt;/sequence&gt;
		&lt;sequence&gt;
			&lt;taxon idref="individual5"/&gt;
			GCGAAATTTAGGTTA...
		&lt;/sequence&gt;
		&lt;sequence&gt;
			&lt;taxon idref="individual6"/&gt;
			GCGAAATTTAGGTTA...
		&lt;/sequence&gt;
	&lt;/alignment&gt;
</pre><p>This assumes that the second locus has the same taxon names as the first (i.e., both loci where sampled from the same set of individuals). If this is not the case then the &lt;taxa&gt; element from the second locus XML file will need to be copied over as well.</p>
<p>Now duplicate the &lt;patterns&gt; element, changing the ids and the idrefs of the alignments they operate on:</p>
<pre>
	&lt;patterns id="patterns1" from="1"&gt;
		&lt;alignment idref="alignment1"/&gt;
	&lt;/patterns&gt;

	&lt;patterns id="patterns2" from="1"&gt;
		&lt;alignment idref="alignment2"/&gt;
	&lt;/patterns&gt;
</pre><p>Duplicate the starting &lt;coalescentTree&gt; element and the &lt;treeModel&gt;. This provides a different and independent tree for each locus and provides a different random starting tree for each:</p>
<pre>
	&lt;coalescentTree id="startingTree1"&gt;
		&lt;taxa idref="taxa"/&gt;
		&lt;constantSize idref="initialDemo"/&gt;
	&lt;/coalescentTree&gt;

	&lt;coalescentTree id="startingTree2"&gt;
		&lt;taxa idref="taxa"/&gt;
		&lt;constantSize idref="initialDemo"/&gt;
	&lt;/coalescentTree&gt;

	&lt;treeModel id="treeModel1"&gt;
		&lt;coalescentTree idref="startingTree1"/&gt;
		&lt;rootHeight&gt;
			&lt;parameter id="treeModel1.rootHeight"/&gt;
		&lt;/rootHeight&gt;
		&lt;nodeHeights internalNodes="true"&gt;
			&lt;parameter id="treeModel1.internalNodeHeights"/&gt;
		&lt;/nodeHeights&gt;
		&lt;nodeHeights internalNodes="true" rootNode="true"&gt;
			&lt;parameter id="treeModel1.allInternalNodeHeights"/&gt;
		&lt;/nodeHeights&gt;
	&lt;/treeModel&gt;

	&lt;treeModel id="treeModel2"&gt;
		&lt;coalescentTree idref="startingTree2"/&gt;
		&lt;rootHeight&gt;
			&lt;parameter id="treeModel2.rootHeight"/&gt;
		&lt;/rootHeight&gt;
		&lt;nodeHeights internalNodes="true"&gt;
			&lt;parameter id="treeModel2.internalNodeHeights"/&gt;
		&lt;/nodeHeights&gt;
		&lt;nodeHeights internalNodes="true" rootNode="true"&gt;
			&lt;parameter id="treeModel2.allInternalNodeHeights"/&gt;
		&lt;/nodeHeights&gt;
	&lt;/treeModel&gt;
</pre><p>Now duplicate the &lt; coalescentLikelihood &gt; element:</p>
<pre>
	&lt;coalescentLikelihood id="coalescent1"&gt;
		&lt;model&gt;
			&lt;constantSize idref="constant"/&gt;
		&lt;/model&gt;
		&lt;populationTree&gt;
			&lt;treeModel idref="treeModel1"/&gt;
		&lt;/populationTree&gt;
	&lt;/coalescentLikelihood&gt;

	&lt;coalescentLikelihood id="coalescent2"&gt;
			&lt;model&gt;
				&lt;constantSize idref="constant"/&gt;
			&lt;/model&gt;
			&lt;populationTree&gt;
				&lt;treeModel idref="treeModel2"/&gt;
			&lt;/populationTree&gt;
		&lt;/coalescentLikelihood&gt;
</pre><p>Now duplicate the &lt;treeLikelihood&gt; element:</p>
<pre>
	&lt;treeLikelihood id="treeLikelihood1"&gt;
		&lt;patterns idref="patterns1"/&gt;
		&lt;treeModel idref="treeModel1"/&gt;
		&lt;siteModel idref="siteModel"/&gt;
	&lt;/treeLikelihood&gt;

	&lt;treeLikelihood id="treeLikelihood2"&gt;
		&lt;patterns idref="patterns2"/&gt;
		&lt;treeModel idref="treeModel2"/&gt;
		&lt;siteModel idref="siteModel"/&gt;
	&lt;/treeLikelihood&gt;
</pre><p>Next we must duplicate the operators for the two trees:</p>
<pre>
	&lt;operators id="operators"&gt;
		&lt;scaleOperator scaleFactor="0.5" weight="1"&gt;
			&lt;parameter idref="hky.kappa"/&gt;
		&lt;/scaleOperator&gt;
		&lt;scaleOperator scaleFactor="0.5" weight="1" adapt="false"&gt;
			&lt;parameter idref="constant.popSize"/&gt;
		&lt;/scaleOperator&gt;
		&lt;scaleOperator scaleFactor="0.5" weight="1"&gt;
			&lt;parameter idref="treeModel1.rootHeight"/&gt;
		&lt;/scaleOperator&gt;
		&lt;uniformOperator weight="10"&gt;
			&lt;parameter idref="treeModel1.internalNodeHeights"/&gt;
		&lt;/uniformOperator&gt;
		&lt;subtreeSlide weight="5" gaussian="true" size="1.0"&gt;
			&lt;treeModel idref="treeModel1"/&gt;
		&lt;/subtreeSlide&gt;
		&lt;narrowExchange weight="1"&gt;
			&lt;treeModel idref="treeModel1"/&gt;
		&lt;/narrowExchange&gt;
		&lt;wideExchange weight="1"&gt;
			&lt;treeModel idref="treeModel1"/&gt;
		&lt;/wideExchange&gt;
		&lt;wilsonBalding weight="1"&gt;
			&lt;treeModel idref="treeModel1"/&gt;
			&lt;constantSize idref="constant"/&gt;
		&lt;/wilsonBalding&gt;
		&lt;scaleOperator scaleFactor="0.5" weight="1"&gt;
			&lt;parameter idref="treeModel2.rootHeight"/&gt;
		&lt;/scaleOperator&gt;
		&lt;uniformOperator weight="10"&gt;
			&lt;parameter idref="treeModel2.internalNodeHeights"/&gt;
		&lt;/uniformOperator&gt;
		&lt;subtreeSlide weight="5" gaussian="true" size="1.0"&gt;
			&lt;treeModel idref="treeModel2"/&gt;
		&lt;/subtreeSlide&gt;
		&lt;narrowExchange weight="1"&gt;
			&lt;treeModel idref="treeModel2"/&gt;
		&lt;/narrowExchange&gt;
		&lt;wideExchange weight="1"&gt;
			&lt;treeModel idref="treeModel2"/&gt;
		&lt;/wideExchange&gt;
		&lt;wilsonBalding weight="1"&gt;
			&lt;treeModel idref="treeModel2"/&gt;
			&lt;constantSize idref="constant"/&gt;
		&lt;/wilsonBalding&gt;
	&lt;/operators&gt;
</pre><p>Finally we must adjust the &lt;mcmc&gt;:</p>
<pre>
	&lt;mcmc id="mcmc" chainLength="10000000" autoOptimize="true"&gt;
		&lt;compoundLikelihood id="likelihood"&gt;
			&lt;coalescentLikelihood idref="coalescent1"/&gt;
			&lt;coalescentLikelihood idref="coalescent2"/&gt;
			&lt;treeLikelihood idref="treeLikelihood1"/&gt;
			&lt;treeLikelihood idref="treeLikelihood2"/&gt;
		&lt;/compoundLikelihood&gt;
		&lt;operators idref="operators"/&gt;
		&lt;log logEvery="10000"&gt;
			&lt;column label="Likelihood" dp="4" width="12"&gt;
				&lt;compoundLikelihood idref="likelihood"/&gt;
			&lt;/column&gt;
			&lt;column label="Root Height 1" sf="6" width="12"&gt;
				&lt;parameter idref="treeModel1.rootHeight"/&gt;
			&lt;/column&gt;
			&lt;column label="Root Height 2" sf="6" width="12"&gt;
				&lt;parameter idref="treeModel2.rootHeight"/&gt;
			&lt;/column&gt;
			&lt;column label="Kappa" sf="6" width="12"&gt;
				&lt;parameter idref="hky.kappa"/&gt;
			&lt;/column&gt;
		&lt;/log&gt;
		&lt;log logEvery="1000" fileName="multilocus.log"&gt;
			&lt;compoundLikelihood idref="likelihood"/&gt;
			&lt;parameter idref="constant.popSize"/&gt;
			&lt;parameter idref="treeModel1.rootHeight"/&gt;
			&lt;parameter idref="treeModel2.rootHeight"/&gt;
			&lt;parameter idref="hky.kappa"/&gt;
			&lt;treeLikelihood idref="treeLikelihood1"/&gt;
			&lt;treeLikelihood idref="treeLikelihood2"/&gt;
			&lt;coalescentLikelihood idref="coalescent1"/&gt;
			&lt;coalescentLikelihood idref="coalescent2"/&gt;
		&lt;/log&gt;
		&lt;logTree  logEvery="1000" nexusFormat="true" fileName="multilocus.locus1.trees"&gt;
			&lt;treeModel idref="treeModel1"/&gt;
		&lt;/logTree&gt;
		&lt;logTree  logEvery="1000" nexusFormat="true" fileName="multilocus.locus2.trees"&gt;
			&lt;treeModel idref="treeModel2"/&gt;
		&lt;/logTree&gt;
	&lt;/mcmc&gt;
</pre><p>It is also possible to duplicate the substitution model and gamma site heterogeneity models to allow for a mixed model between loci.</p>
<hr /><p><a href="Tutorials.html" style="text-decoration: none; color: rgb(90, 54, 150); background-image: none; background-position: initial initial; background-repeat: initial initial;" title="Tutorials">Return to Tutorials</a></p>
</div></div></div>  </div>

  <div class="clearfix">
          <div class="links"></div>
    
      </div>

</div>
          </div>
                          </div></div></div></div> <!-- /.left-corner, /.right-corner, /#squeeze, /#center -->

      
    </div> <!-- /#container -->
  </div> <!-- /#wrapper -->
  </body>
</html>
